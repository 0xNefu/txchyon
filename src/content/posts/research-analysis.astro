---
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";
import { CATEGORY_HIERARCHY } from "../../lib/categories";

const pillar = "research-analysis";
const pillarData = CATEGORY_HIERARCHY[pillar];

const allPosts = await getCollection("posts", ({ data }) => !data.draft);

// Filter posts for this pillar
const pillarPosts = allPosts.filter(post => {
  const cats = post.data.categories || [];
  return cats.some(cat => cat === pillar || cat.startsWith(pillar + "/"));
});

// Sort by date (newest first)
pillarPosts.sort((a, b) => b.data.date - a.data.date);
---

<Base title="{pillarData.name} | Txchyon">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">
      {pillarData.icon} {pillarData.name}
    </h1>
    
    <p class="text-gray-600 mb-8">
      {pillarPosts.length} {pillarPosts.length === 1 ? "article" : "articles"} found
    </p>
    
    {pillarPosts.length > 0 ? (
      <div class="space-y-6">
        {pillarPosts.map(post => (
          <article class="border rounded-lg p-6 hover:shadow-md">
            <a href={`/blog/${post.id}`} class="block">
              <h2 class="text-xl font-bold text-blue-600 hover:text-blue-800">
                {post.data.title}
              </h2>
            </a>
            <p class="text-gray-600 mt-2">{post.data.description}</p>
          </article>
        ))}
      </div>
    ) : (
      <div class="text-center py-12 border rounded">
        <p>No articles in this category yet.</p>
      </div>
    )}
  </div>
</Base>
